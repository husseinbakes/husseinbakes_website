<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Order | Hussein Bakes</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Order custom cakes or fresh pizza from Hussein Bakes in Kitui Town. 48-hour pre-order for cakes, 3-4 hour preparation for pizza. Order via WhatsApp." />
  <meta name="robots" content="index, follow" />
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XCYY3DCRKB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XCYY3DCRKB');
</script>
  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Order | Hussein Bakes" />
  <meta property="og:description" content="Order custom cakes or fresh pizza from Hussein Bakes in Kitui Town." />
  <meta property="og:image" content="https://husseinbakes.github.io/husseinbakes_website/images/logo.webp" />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- Favicons -->
  <link rel="icon" href="images/favicon.ico" sizes="any">
  <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="manifest" href="images/site.webmanifest">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'midnight': '#0B1320',
            'offwhite': '#F3F2EE',
            'softgray': '#CFCBC3',
            'goldlight': '#E6C97A',
            'metgold': '#C9A24D',
            'golddeep': '#A8833A',
          },
          fontFamily: {
            'playfair': ['Playfair Display', 'serif'],
            'inter': ['Inter', 'sans-serif'],
          },
          backgroundImage: {
            'gold-gradient': 'linear-gradient(135deg, #E6C97A, #C9A24D, #A8833A)',
            'gold-gradient-hover': 'linear-gradient(135deg, #C9A24D, #A8833A, #8B6B2E)',
          }
        }
      }
    }
  </script>
  
  <style>
    /* Custom styles for order flow */
    .order-summary-item { 
      display: flex; 
      justify-content: space-between; 
      padding: 8px 0;
      border-bottom: 1px solid rgba(201, 162, 77, 0.1);
    }
    .order-summary-total {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-top: 2px solid #C9A24D;
      font-weight: bold;
      margin-top: 8px;
    }
    .addon-item:hover {
      background: rgba(201, 162, 77, 0.05);
    }
    .size-option {
      transition: all 0.2s ease;
    }
    .size-option:hover {
      border-color: #C9A24D !important;
      background: rgba(201, 162, 77, 0.05);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      ring: 2px;
    }
  </style>
</head>

<body class="bg-midnight text-offwhite font-inter min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 z-40 bg-midnight/95 backdrop-blur border-b border-metgold/20">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <!-- Logo -->
    <a href="index.html" class="flex items-center gap-3">
      <img src="images/logo.webp" alt="Hussein Bakes Logo" class="h-10 w-auto" width="40" height="40" loading="lazy">
      <div class="hidden md:block">
        <div class="font-playfair text-xl font-semibold text-offwhite">HUSSEIN BAKES</div>
        <div class="text-softgray text-xs tracking-wider">KITUI TOWN</div>
      </div>
    </a>
    
    <!-- Navigation -->
    <nav class="flex gap-6 items-center text-sm">
      <a href="index.html" class="text-softgray hover:text-offwhite transition duration-200">Home</a>
      <a href="cakes.html" class="text-softgray hover:text-offwhite transition duration-200">Cakes</a>
      <a href="pizza.html" class="text-softgray hover:text-offwhite transition duration-200">Pizza</a>
      <a href="https://wa.me/254710975805" 
         class="bg-gold-gradient text-midnight hover:bg-gold-gradient-hover px-5 py-2.5 rounded-full font-semibold flex items-center gap-2 transition-all duration-300 shadow-lg hover:shadow-metgold/20"
         aria-label="Order on WhatsApp">
        <img src="images/whatsapp-icon.webp" alt="WhatsApp" class="h-4 w-4" width="16" height="16" loading="lazy">
        Order Now
      </a>
    </nav>
  </div>
</header>

<!-- MAIN CONTENT -->
<main class="max-w-6xl mx-auto px-4 py-8">
  <div id="productContainer" class="space-y-8">
    <!-- Loading State -->
    <div class="text-center py-12" id="loadingState">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-metgold mx-auto mb-4"></div>
      <p class="text-softgray">Loading product details...</p>
    </div>
  </div>
</main>

<!-- CONFIRMATION MODAL -->
<div id="confirmModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
  <div class="bg-midnight border border-metgold/30 rounded-2xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
    <h2 class="font-playfair text-2xl mb-6 text-center">Confirm Your Order</h2>
    
    <div id="orderSummary" class="mb-6 space-y-4">
      <!-- Order summary will be inserted here -->
    </div>
    
    <!-- Important Notes -->
    <div id="orderNotes" class="mb-6 p-4 bg-midnight/50 border border-metgold/20 rounded-lg">
      <!-- Notes will be inserted here -->
    </div>
    
    <div class="flex gap-4">
      <button onclick="closeConfirm()" 
              class="flex-1 border border-metgold/30 text-metgold hover:bg-metgold/10 py-3 rounded-full transition duration-200"
              aria-label="Edit your order">
        Edit Order
      </button>
      <button onclick="sendToWhatsApp()" 
              class="flex-1 bg-gold-gradient text-midnight hover:bg-gold-gradient-hover font-semibold py-3 rounded-full transition duration-200"
              aria-label="Confirm and send order to WhatsApp">
        Confirm & Send
      </button>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="border-t border-metgold/10 py-12 mt-12">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex flex-col lg:flex-row justify-between items-center gap-8">
      <!-- Brand -->
      <div class="text-center lg:text-left">
        <div class="flex flex-col items-center lg:items-start gap-4">
          <img src="images/logo.webp" alt="Hussein Bakes Logo" class="h-14 w-auto" width="56" height="56" loading="lazy">
          <div>
            <div class="font-playfair text-xl font-semibold">HUSSEIN BAKES</div>
            <div class="text-softgray text-sm tracking-wider">PREMIUM BAKERY ‚Ä¢ KITUI TOWN</div>
          </div>
        </div>
      </div>
      
      <!-- Contact -->
      <div class="text-center">
        <h4 class="font-semibold mb-4 text-metgold">Contact Us</h4>
        <div class="space-y-3">
          <a href="tel:+254710975805" class="block text-offwhite hover:text-metgold transition">
            üìû +254 710 975 805
          </a>
          <a href="https://wa.me/254710975805" class="block text-offwhite hover:text-metgold transition">
            üí¨ WhatsApp Orders
          </a>
        </div>
      </div>
      
      <!-- Navigation -->
      <div class="text-center">
        <h4 class="font-semibold mb-4 text-metgold">Navigation</h4>
        <div class="space-y-3">
          <a href="index.html" class="block text-softgray hover:text-offwhite transition font-light">Home</a>
          <a href="cakes.html" class="block text-softgray hover:text-offwhite transition font-light">Cakes</a>
          <a href="pizza.html" class="block text-softgray hover:text-offwhite transition font-light">Pizza</a>
        </div>
      </div>
    </div>
    
    <!-- Copyright -->
    <div class="border-t border-metgold/10 mt-8 pt-8 text-center">
      <p class="text-softgray text-sm font-light">
        ¬© 2025 Hussein Bakes. All rights reserved.
      </p>
      <p class="text-softgray text-xs mt-1">
        Kitui Town, Kitui County, Kenya
      </p>
    </div>
  </div>
</footer>

<!-- PRODUCTS SCRIPT -->
<script src="js/products.js"></script>

<!-- PRODUCT PAGE LOGIC -->
<script>
  // Global variables
  let currentProduct = null;
  let orderData = {};
  let finalWhatsAppMessage = "";
  
  // DOM Ready
  document.addEventListener('DOMContentLoaded', function() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    
    if (!id) {
      showError("No product selected. Please select a product from our menu.");
      return;
    }
    
    currentProduct = window.getProductById(id);
    
    if (!currentProduct) {
      showError("Product not found. Please select a valid product from our menu.");
      return;
    }
    
    loadProductPage();
  });
  
  // Load product page
  function loadProductPage() {
    // Hide loading state
    document.getElementById('loadingState').style.display = 'none';
    
    // Determine category for back button
    const categoryName = currentProduct.category === 'cakes' ? 'Cakes' : 'Pizza';
    const categoryPage = currentProduct.category === 'cakes' ? 'cakes.html' : 'pizza.html';
    const categoryEmoji = currentProduct.category === 'cakes' ? 'üéÇ' : 'üçï';
    
    // Get price range
    const priceRange = window.getProductPriceRange(currentProduct);
    const minPrice = priceRange.min;
    const maxPrice = priceRange.max;
    
    // Check for Friday offer
    const fridayOffer = window.getFridayOffer(currentProduct);
    
    // Build size options
    let sizeOptions = '';
    let sizeOptionsHTML = '';
    let firstSize = null;
    
    Object.entries(currentProduct.prices).forEach(([sizeName, price], index) => {
      sizeOptions += `<option value="${sizeName}|${price}">${sizeName} - KES ${price.toLocaleString()}</option>`;
      
      if (index === 0) firstSize = { name: sizeName, price: price };
      
      sizeOptionsHTML += `
        <label class="size-option cursor-pointer">
          <input type="radio" name="size" value="${sizeName}|${price}" 
                 ${index === 0 ? 'checked' : ''}
                 class="hidden peer">
          <div class="border border-metgold/20 rounded-lg p-4 text-center peer-checked:border-metgold peer-checked:bg-metgold/10 transition">
            <div class="font-semibold">${sizeName}</div>
            <div class="text-metgold font-bold mt-1">KES ${price.toLocaleString()}</div>
          </div>
        </label>
      `;
    });
    
    // Build addon checkboxes
    let addonsHTML = '';
    if (currentProduct.addons && currentProduct.addons.length > 0) {
      addonsHTML = `
        <div class="mb-8">
          <h3 class="font-semibold text-lg mb-4 text-metgold">Add-ons</h3>
          <p class="text-softgray text-sm mb-4">Select any additional items you'd like:</p>
          <div class="space-y-2">
            ${currentProduct.addons.map((addon, index) => `
              <label class="addon-item flex items-center p-3 border border-metgold/20 rounded-lg hover:border-metgold/40 transition cursor-pointer">
                <input type="checkbox" 
                       id="addon-${index}"
                       data-name="${addon.name}" 
                       data-price="${addon.price}"
                       class="mr-3 h-5 w-5 text-metgold rounded border-metgold/30 focus:ring-metgold/30 cursor-pointer"
                       ${addon.price === 0 ? 'checked' : ''}>
                <span class="flex-1">
                  <span class="font-medium">${addon.name}</span>
                  ${addon.price > 0 ? `<span class="text-softgray text-sm ml-2">(+KES ${addon.price})</span>` : ''}
                </span>
              </label>
            `).join('')}
          </div>
        </div>
      `;
    }
    
    // Build delivery options (only for pizza)
    let deliveryHTML = '';
    if (currentProduct.category === 'pizza') {
      deliveryHTML = `
        <div class="mb-8">
          <h3 class="font-semibold text-lg mb-4 text-metgold">Delivery Option</h3>
          <div class="space-y-3">
            <label class="flex items-center p-3 border border-metgold/20 rounded-lg cursor-pointer">
              <input type="radio" name="delivery" value="Pickup|0" checked class="mr-3 h-5 w-5 text-metgold">
              <span class="flex-1">
                <span class="font-medium">Pickup at Hussein Bakes</span>
                <span class="text-softgray text-sm block">Free ‚Ä¢ Kitui Town</span>
              </span>
            </label>
            <label class="flex items-center p-3 border border-metgold/20 rounded-lg cursor-pointer">
              <input type="radio" name="delivery" value="Delivery|100" class="mr-3 h-5 w-5 text-metgold">
              <span class="flex-1">
                <span class="font-medium">Delivery within Kitui Town</span>
                <span class="text-softgray text-sm block">+KES 100 ‚Ä¢ Until 6:00 PM daily</span>
              </span>
            </label>
          </div>
        </div>
        
        <!-- Address Field (Hidden by Default) -->
        <div id="addressField" class="hidden mb-8">
          <label class="block mb-2 font-medium">Delivery Address</label>
          <input id="address" 
                 type="text" 
                 class="w-full p-4 bg-midnight border border-metgold/30 rounded-lg text-offwhite focus:border-metgold focus:ring-2 focus:ring-metgold/20 transition"
                 placeholder="Enter your full address in Kitui Town"
                 aria-label="Delivery address">
          <p class="text-softgray text-xs mt-2">Please provide your complete address for delivery</p>
        </div>
      `;
    } else {
      // For cakes - no delivery option
      deliveryHTML = `
        <div class="mb-8 p-4 border border-metgold/20 rounded-lg bg-midnight/50">
          <div class="flex items-center gap-3">
            <div class="text-metgold text-xl">üìç</div>
            <div>
              <p class="font-medium">Pickup Only</p>
              <p class="text-softgray text-sm">All cakes are for pickup at Hussein Bakes in Kitui Town</p>
            </div>
          </div>
        </div>
      `;
    }
    
    // Build the product page
    document.getElementById('productContainer').innerHTML = `
      <!-- Back Button -->
      <div class="mb-6">
        <a href="${categoryPage}" 
           class="inline-flex items-center text-softgray hover:text-offwhite transition"
           aria-label="Back to ${categoryName}">
          ‚Üê Back to ${categoryName}
        </a>
      </div>
      
      <div class="lg:grid lg:grid-cols-2 lg:gap-12">
        <!-- Product Image Column -->
        <div>
          <div class="rounded-2xl overflow-hidden border border-metgold/20 mb-6">
            <img src="${currentProduct.image}" 
                 alt="${currentProduct.name} - ${currentProduct.category === 'cakes' ? 'Custom cake' : 'Fresh pizza'} in Kitui Town by Hussein Bakes" 
                 class="w-full h-auto max-h-[500px] object-cover"
                 width="600" height="400"
                 onerror="this.src='https://placehold.co/600x400/0B1320/F3F2EE?text=${encodeURIComponent(currentProduct.name)}'"
                 loading="lazy">
          </div>
          
          <!-- Badge & Price -->
          <div class="flex flex-wrap items-center gap-3 mb-4">
            ${currentProduct.badge ? `
              <div class="${currentProduct.badge === 'Signature' ? 'bg-goldlight text-midnight' : 'bg-metgold text-midnight'} text-sm font-semibold px-4 py-1.5 rounded-full">
                ${currentProduct.badge}
              </div>
            ` : ''}
            
            <div class="text-lg font-bold text-metgold">
              ${minPrice === maxPrice ? 
                `KES ${minPrice.toLocaleString()}` : 
                `KES ${minPrice.toLocaleString()} - ${maxPrice.toLocaleString()}`}
            </div>
          </div>
          
          <!-- Special Offer -->
          ${fridayOffer ? `
            <div class="p-4 border border-goldlight/30 bg-goldlight/10 rounded-lg">
              <div class="flex items-center gap-2">
                <div class="text-goldlight text-xl">üéÅ</div>
                <span class="text-goldlight font-semibold">${fridayOffer}</span>
              </div>
            </div>
          ` : ''}
        </div>
        
        <!-- Product Details Column -->
        <div>
          <h1 class="font-playfair text-3xl md:text-4xl font-semibold mb-4">${currentProduct.name}</h1>
          <p class="text-softgray text-lg mb-6">${currentProduct.description}</p>
          
          <!-- Preparation Time Notice -->
          <div class="mb-8 p-4 border-2 ${currentProduct.category === 'cakes' ? 'border-red-500/50 bg-red-500/10' : 'border-goldlight/50 bg-goldlight/10'} rounded-lg">
            <div class="flex items-center gap-3">
              <div class="${currentProduct.category === 'cakes' ? 'text-red-400' : 'text-goldlight'} text-2xl">‚è±Ô∏è</div>
              <div>
                <p class="${currentProduct.category === 'cakes' ? 'text-red-400' : 'text-goldlight'} font-bold uppercase text-sm tracking-wide">
                  ${currentProduct.category === 'cakes' ? '48-HOUR PRE-ORDER REQUIRED' : '3-4 HOUR PREPARATION REQUIRED'}
                </p>
                <p class="${currentProduct.category === 'cakes' ? 'text-red-400/90' : 'text-goldlight/90'} text-sm">
                  ${currentProduct.rules.notice || `Please order ${currentProduct.category === 'cakes' ? '2 days' : '3-4 hours'} in advance`}
                </p>
              </div>
            </div>
          </div>
          
          <!-- Size Selection -->
          <div class="mb-8">
            <h3 class="font-semibold text-lg mb-4 text-metgold">Select Size</h3>
            <div class="grid grid-cols-2 gap-3" id="sizeOptions">
              ${sizeOptionsHTML}
            </div>
          </div>
          
          ${addonsHTML}
          
          ${deliveryHTML}
          
          <!-- Customer Details -->
          <div class="mb-8 p-6 border border-metgold/20 rounded-xl bg-midnight/50">
            <h3 class="font-semibold text-lg mb-4 text-metgold">Your Details</h3>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2" for="name">Your Name *</label>
                <input id="name" 
                       type="text" 
                       required
                       class="w-full p-3 bg-midnight border border-metgold/30 rounded-lg text-offwhite focus:border-metgold focus:ring-2 focus:ring-metgold/20 transition"
                       placeholder="Enter your full name"
                       aria-label="Your name">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2" for="phone">Phone Number *</label>
                <input id="phone" 
                       type="tel" 
                       required
                       class="w-full p-3 bg-midnight border border-metgold/30 rounded-lg text-offwhite focus:border-metgold focus:ring-2 focus:ring-metgold/20 transition"
                       placeholder="0712 345 678"
                       aria-label="Phone number">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2" for="instructions">Special Instructions (Optional)</label>
                <textarea id="instructions" 
                          rows="3"
                          class="w-full p-3 bg-midnight border border-metgold/30 rounded-lg text-offwhite focus:border-metgold focus:ring-2 focus:ring-metgold/20 transition"
                          placeholder="Any special requests, allergies, or specific requirements"
                          aria-label="Special instructions"></textarea>
              </div>
            </div>
          </div>
          
          <!-- Order Button -->
          <button onclick="prepareOrder()" 
                  class="w-full bg-gold-gradient text-midnight hover:bg-gold-gradient-hover font-semibold py-4 px-8 rounded-full text-lg flex items-center justify-center gap-3 transition-all duration-300 shadow-xl hover:shadow-2xl hover:shadow-metgold/30"
                  aria-label="${currentProduct.category === 'cakes' ? 'Pre-order this cake' : 'Order this pizza'}">
            ${categoryEmoji}
            ${currentProduct.category === 'cakes' ? 'Pre-Order Cake (48hrs)' : 'Order Pizza (3-4hrs)'}
          </button>
          
          <p class="text-center text-softgray text-sm mt-4">
            You'll review your order before sending to WhatsApp
          </p>
        </div>
      </div>
    `;
    
    // Add event listeners for delivery option
    if (currentProduct.category === 'pizza') {
      const deliveryRadios = document.querySelectorAll('input[name="delivery"]');
      deliveryRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          const addressField = document.getElementById('addressField');
          const [deliveryType] = this.value.split('|');
          addressField.classList.toggle('hidden', deliveryType !== 'Delivery');
          
          // Clear address if switching to pickup
          if (deliveryType === 'Pickup') {
            document.getElementById('address').value = '';
          }
        });
      });
    }
    
    // Add event listeners for size options
    const sizeInputs = document.querySelectorAll('#sizeOptions input[type="radio"]');
    sizeInputs.forEach(input => {
      input.addEventListener('change', function() {
        // Add visual feedback
        sizeInputs.forEach(i => {
          i.parentElement.querySelector('div').classList.remove('border-metgold', 'bg-metgold/10');
        });
        this.parentElement.querySelector('div').classList.add('border-metgold', 'bg-metgold/10');
      });
    });
  }
  
  // Prepare order for confirmation
  function prepareOrder() {
    // Get selected size and price
    const sizeInput = document.querySelector('input[name="size"]:checked');
    if (!sizeInput) {
      alert('Please select a size');
      return;
    }
    
    const [selectedSize, basePrice] = sizeInput.value.split('|');
    
    // Get selected addons
    const addons = [];
    const addonCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    addonCheckboxes.forEach(checkbox => {
      addons.push({
        name: checkbox.dataset.name,
        price: parseInt(checkbox.dataset.price)
      });
    });
    
    // Get delivery details
    let deliveryOption = "Pickup";
    let deliveryFee = 0;
    let address = "";
    
    if (currentProduct.category === 'pizza') {
      const deliveryInput = document.querySelector('input[name="delivery"]:checked');
      if (deliveryInput) {
        [deliveryOption, deliveryFee] = deliveryInput.value.split('|');
        deliveryFee = parseInt(deliveryFee);
        
        if (deliveryOption === 'Delivery') {
          const addressInput = document.getElementById('address');
          address = addressInput ? addressInput.value.trim() : "";
        }
      }
    }
    
    // Get customer details
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const instructions = document.getElementById('instructions').value.trim();
    
    // Validation
    if (!name) {
      alert('Please enter your name');
      document.getElementById('name').focus();
      return;
    }
    
    if (!phone) {
      alert('Please enter your phone number');
      document.getElementById('phone').focus();
      return;
    }
    
    // Basic phone validation for Kenya
    const phoneRegex = /^(07|01)\d{8}$/;
    const cleanPhone = phone.replace(/\s+/g, '');
    if (!phoneRegex.test(cleanPhone)) {
      alert('Please enter a valid Kenyan phone number (e.g., 0712345678)');
      document.getElementById('phone').focus();
      return;
    }
    
    if (currentProduct.category === 'pizza' && deliveryOption === 'Delivery' && !address) {
      alert('Please enter your delivery address');
      document.getElementById('address').focus();
      return;
    }
    
    // Calculate total
    let subtotal = parseInt(basePrice);
    addons.forEach(addon => subtotal += addon.price);
    const total = subtotal + deliveryFee;
    
    // Store order data
    orderData = {
      product: currentProduct.name,
      category: currentProduct.category,
      size: selectedSize,
      basePrice: parseInt(basePrice),
      addons: addons,
      deliveryOption: deliveryOption,
      deliveryFee: deliveryFee,
      address: address,
      customerName: name,
      customerPhone: cleanPhone,
      instructions: instructions,
      subtotal: subtotal,
      total: total,
      fridayOffer: window.getFridayOffer(currentProduct),
      preparationTime: currentProduct.category === 'cakes' ? '48 hours' : '3-4 hours'
    };
    
    // Build confirmation message
    showConfirmation();
  }
  
  // Show confirmation modal
  function showConfirmation() {
    // Build order summary HTML
    let summaryHTML = `
      <div class="order-summary-item">
        <span>${orderData.product}</span>
        <span>KES ${orderData.basePrice.toLocaleString()}</span>
      </div>
      
      <div class="order-summary-item">
        <span>${orderData.size}</span>
        <span>Base price</span>
      </div>
    `;
    
    // Add addons
    if (orderData.addons.length > 0) {
      orderData.addons.forEach(addon => {
        if (addon.price > 0) {
          summaryHTML += `
            <div class="order-summary-item">
              <span>+ ${addon.name}</span>
              <span>KES ${addon.price}</span>
            </div>
          `;
        }
      });
    }
    
    // Add delivery
    summaryHTML += `
      <div class="order-summary-item">
        <span>${orderData.deliveryOption}</span>
        <span>${orderData.deliveryFee > 0 ? `KES ${orderData.deliveryFee}` : 'Free'}</span>
      </div>
    `;
    
    // Add total
    summaryHTML += `
      <div class="order-summary-total">
        <span>TOTAL AMOUNT</span>
        <span>KES ${orderData.total.toLocaleString()}</span>
      </div>
      
      <div class="mt-4 pt-4 border-t border-metgold/20">
        <p><strong>Customer:</strong> ${orderData.customerName}</p>
        <p><strong>Phone:</strong> ${orderData.customerPhone}</p>
        ${orderData.address ? `<p><strong>Address:</strong> ${orderData.address}</p>` : ''}
        ${orderData.instructions ? `<p><strong>Instructions:</strong> ${orderData.instructions}</p>` : ''}
      </div>
    `;
    
    // Build notes HTML
    let notesHTML = `
      <p class="font-medium mb-2 text-metgold">Important Notes:</p>
      <ul class="text-sm space-y-1 text-softgray">
        <li>‚Ä¢ ${orderData.preparationTime} ${orderData.category === 'cakes' ? 'pre-order required' : 'preparation time'}</li>
        ${orderData.category === 'cakes' ? '<li>‚Ä¢ Cakes are pickup only at Hussein Bakes, Kitui Town</li>' : ''}
        ${orderData.category === 'pizza' ? '<li>‚Ä¢ Pizza delivery available until 6:00 PM daily</li>' : ''}
        ${orderData.fridayOffer ? `<li>‚Ä¢ ${orderData.fridayOffer}</li>` : ''}
        <li>‚Ä¢ You'll be redirected to WhatsApp to confirm your order</li>
        <li>‚Ä¢ Payment via M-Pesa on pickup/delivery</li>
      </ul>
    `;
    
    // Update modal content
    document.getElementById('orderSummary').innerHTML = summaryHTML;
    document.getElementById('orderNotes').innerHTML = notesHTML;
    
    // Show modal
    document.getElementById('confirmModal').classList.remove('hidden');
    
    // Generate WhatsApp message
    generateWhatsAppMessage();
  }
  
  // Generate WhatsApp message
  function generateWhatsAppMessage() {
    const orderId = "HB-" + Date.now().toString().slice(-6);
    const isFriday = window.isFriday();
    const today = new Date().toLocaleDateString('en-KE', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    let message = `üéØ *NEW ORDER - HUSSEIN BAKES* üéØ\n`;
    message += `Order ID: ${orderId}\n`;
    message += `Date: ${today}\n\n`;
    
    message += `*PRODUCT DETAILS*\n`;
    message += `Product: ${orderData.product}\n`;
    message += `Size: ${orderData.size}\n`;
    message += `Base Price: KES ${orderData.basePrice.toLocaleString()}\n\n`;
    
    if (orderData.addons.length > 0) {
      message += `*ADD-ONS*\n`;
      orderData.addons.forEach(addon => {
        message += `‚Ä¢ ${addon.name} ${addon.price > 0 ? `(KES ${addon.price})` : ''}\n`;
      });
      message += `\n`;
    }
    
    message += `*DELIVERY DETAILS*\n`;
    message += `Option: ${orderData.deliveryOption}\n`;
    if (orderData.address) {
      message += `Address: ${orderData.address}\n`;
    }
    message += `Delivery Fee: KES ${orderData.deliveryFee}\n\n`;
    
    message += `*PRICING*\n`;
    message += `Subtotal: KES ${orderData.subtotal.toLocaleString()}\n`;
    message += `Delivery: KES ${orderData.deliveryFee}\n`;
    message += `*TOTAL: KES ${orderData.total.toLocaleString()}*\n\n`;
    
    if (orderData.fridayOffer && orderData.category === 'pizza') {
      message += `*SPECIAL OFFER*\n`;
      message += `${orderData.fridayOffer}\n\n`;
    }
    
    message += `*CUSTOMER INFORMATION*\n`;
    message += `Name: ${orderData.customerName}\n`;
    message += `Phone: ${orderData.customerPhone}\n`;
    if (orderData.instructions) {
      message += `Instructions: ${orderData.instructions}\n`;
    }
    message += `\n`;
    
    message += `*ORDER NOTES*\n`;
    message += `Preparation: ${orderData.preparationTime}\n`;
    message += `Delivery: ${orderData.category === 'cakes' ? 'Pickup only at Hussein Bakes, Kitui Town' : 'Available within Kitui Town until 6:00 PM'}\n`;
    message += `Payment: M-Pesa on pickup/delivery\n`;
    message += `\n`;
    
    message += `---\n`;
    message += `Please confirm this order and provide payment details. Thank you! üôè`;
    
    finalWhatsAppMessage = message;
  }
  
  // Close confirmation modal
  function closeConfirm() {
    document.getElementById('confirmModal').classList.add('hidden');
  }
  
  // Send to WhatsApp
  function sendToWhatsApp() {
    const encodedMessage = encodeURIComponent(finalWhatsAppMessage);
    window.open(`https://wa.me/254710975805?text=${encodedMessage}`, '_blank');
    closeConfirm();
    
    // Optional: Track order attempt
    console.log('Order sent to WhatsApp:', orderData);
  }
  
  // Show error state
  function showError(message) {
    document.getElementById('productContainer').innerHTML = `
      <div class="text-center py-12">
        <div class="text-4xl mb-6">‚ö†Ô∏è</div>
        <h2 class="font-playfair text-2xl mb-4">${message}</h2>
        <p class="text-softgray mb-6">Please try selecting a product from our menu.</p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="cakes.html" class="inline-block border border-metgold text-metgold hover:bg-metgold hover:text-midnight px-6 py-3 rounded-lg transition">
            Browse Cakes
          </a>
          <a href="pizza.html" class="inline-block border border-metgold text-metgold hover:bg-metgold hover:text-midnight px-6 py-3 rounded-lg transition">
            Browse Pizza
          </a>
        </div>
      </div>
    `;
  }
</script>

</body>
</html>
